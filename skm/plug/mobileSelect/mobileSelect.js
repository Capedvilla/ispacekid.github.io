!function(){function getClass(dom,string){return dom.getElementsByClassName(string)}function MobileSelect(config){this.mobileSelect,this.wheelsData=config.wheels,this.jsonType=!1,this.cascadeJsonData=[],this.displayJson=[],this.cascade=!1,this.startY,this.moveEndY,this.moveY,this.oldMoveY,this.offset=0,this.offsetSum=0,this.oversizeBorder,this.curDistance=[],this.clickStatus=!1,this.isPC=!0,this.init(config)}MobileSelect.prototype={constructor:MobileSelect,init:function(config){var _this=this;if(_this.keyMap=config.keyMap||{id:"id",value:"value",childs:"childs"},_this.checkDataType(),_this.renderWheels(_this.wheelsData,config.cancelBtnText,config.ensureBtnText),_this.trigger=document.querySelector(config.trigger),!_this.trigger)return console.error("mobileSelect has been successfully installed, but no trigger found on your page."),!1;if(_this.wheel=getClass(_this.mobileSelect,"wheel"),_this.slider=getClass(_this.mobileSelect,"selectContainer"),_this.wheels=_this.mobileSelect.querySelector(".wheels"),_this.liHeight=_this.mobileSelect.querySelector("li").offsetHeight,_this.ensureBtn=_this.mobileSelect.querySelector(".ensure"),_this.cancelBtn=_this.mobileSelect.querySelector(".cancel"),_this.grayLayer=_this.mobileSelect.querySelector(".grayLayer"),_this.popUp=_this.mobileSelect.querySelector(".content"),_this.callback=config.callback||function(){},_this.transitionEnd=config.transitionEnd||function(){},_this.initPosition=config.position||[],_this.titleText=config.title||"",_this.connector=config.connector||" ",_this.trigger.style.cursor="pointer",_this.setStyle(config),_this.setTitle(_this.titleText),_this.checkIsPC(),_this.checkCascade(),_this.cascade&&_this.initCascade(),_this.initPosition.length<_this.slider.length)for(var diff=_this.slider.length-_this.initPosition.length,i=0;i<diff;i++)_this.initPosition.push(0);_this.setCurDistance(_this.initPosition),_this.addListenerAll(),_this.cancelBtn.addEventListener("click",function(){_this.mobileSelect.classList.remove("mobileSelect-show")}),_this.ensureBtn.addEventListener("click",function(){_this.mobileSelect.classList.remove("mobileSelect-show");for(var tempValue="",i=0;i<_this.wheel.length;i++)i==_this.wheel.length-1?tempValue+=_this.getInnerHtml(i):tempValue+=_this.getInnerHtml(i)+_this.connector;_this.trigger.innerHTML=tempValue,_this.callback(_this.getIndexArr(),_this.getValue())}),_this.trigger.addEventListener("click",function(){_this.mobileSelect.classList.add("mobileSelect-show")}),_this.grayLayer.addEventListener("click",function(){_this.mobileSelect.classList.remove("mobileSelect-show")}),_this.popUp.addEventListener("click",function(){event.stopPropagation()}),_this.fixRowStyle()},setTitle:function(string){this.titleText=string,this.mobileSelect.querySelector(".title").innerHTML=this.titleText},setStyle:function(config){config.ensureBtnColor&&(this.ensureBtn.style.color=config.ensureBtnColor),config.cancelBtnColor&&(this.cancelBtn.style.color=config.cancelBtnColor),config.titleColor&&(this.title=this.mobileSelect.querySelector(".title"),this.title.style.color=config.titleColor),config.textColor&&(this.panel=this.mobileSelect.querySelector(".panel"),this.panel.style.color=config.textColor),config.titleBgColor&&(this.btnBar=this.mobileSelect.querySelector(".btnBar"),this.btnBar.style.backgroundColor=config.titleBgColor),config.bgColor&&(this.panel=this.mobileSelect.querySelector(".panel"),this.shadowMask=this.mobileSelect.querySelector(".shadowMask"),this.panel.style.backgroundColor=config.bgColor,this.shadowMask.style.background="linear-gradient(to bottom, "+config.bgColor+", rgba(255, 255, 255, 0), "+config.bgColor+")")},checkIsPC:function(){var sUserAgent=navigator.userAgent.toLowerCase(),bIsIphoneOs=(sUserAgent.match(/ipad/i),"iphone os"==sUserAgent.match(/iphone os/i)),bIsMidp="midp"==sUserAgent.match(/midp/i),bIsUc7="rv:1.2.3.4"==sUserAgent.match(/rv:1.2.3.4/i),bIsUc="ucweb"==sUserAgent.match(/ucweb/i),bIsAndroid="android"==sUserAgent.match(/android/i),bIsCE="windows ce"==sUserAgent.match(/windows ce/i),sUserAgent="windows mobile"==sUserAgent.match(/windows mobile/i);(bIsIphoneOs||bIsMidp||bIsUc7||bIsUc||bIsAndroid||bIsCE||sUserAgent)&&(this.isPC=!1)},show:function(){this.mobileSelect.classList.add("mobileSelect-show")},renderWheels:function(wheelsData,cancelBtnText,ensureBtnText){for(var cancelBtnText=cancelBtnText||"取消",ensureBtnText=ensureBtnText||"确认",tempHTML=(this.mobileSelect=document.createElement("div"),this.mobileSelect.className="mobileSelect",this.mobileSelect.innerHTML='<div class="grayLayer"></div><div class="content"><div class="btnBar"><div class="fixWidth"><div class="cancel">'+cancelBtnText+'</div><div class="title"></div><div class="ensure">'+ensureBtnText+'</div></div></div><div class="panel"><div class="fixWidth"><div class="wheels"></div><div class="selectLine"></div><div class="shadowMask"></div></div></div></div>',document.body.appendChild(this.mobileSelect),""),i=0;i<wheelsData.length;i++){if(tempHTML+='<div class="wheel"><ul class="selectContainer">',this.jsonType)for(var j=0;j<wheelsData[i].data.length;j++)tempHTML+='<li data-id="'+wheelsData[i].data[j][this.keyMap.id]+'">'+wheelsData[i].data[j][this.keyMap.value]+"</li>";else for(j=0;j<wheelsData[i].data.length;j++)tempHTML+="<li>"+wheelsData[i].data[j]+"</li>";tempHTML+="</ul></div>"}this.mobileSelect.querySelector(".wheels").innerHTML=tempHTML},addListenerAll:function(){for(var _this=this,i=0;i<_this.slider.length;i++)!function(i){_this.addListenerWheel(_this.wheel[i],i),_this.addListenerLi(i)}(i)},addListenerWheel:function(theWheel,index){var _this=this;theWheel.addEventListener("touchstart",function(){_this.touch(event,this.firstChild,index)},!1),theWheel.addEventListener("touchend",function(){_this.touch(event,this.firstChild,index)},!1),theWheel.addEventListener("touchmove",function(){_this.touch(event,this.firstChild,index)},!1),_this.isPC&&(theWheel.addEventListener("mousedown",function(){_this.dragClick(event,this.firstChild,index)},!1),theWheel.addEventListener("mousemove",function(){_this.dragClick(event,this.firstChild,index)},!1),theWheel.addEventListener("mouseup",function(){_this.dragClick(event,this.firstChild,index)},!0))},addListenerLi:function(sliderIndex){for(var _this=this,curWheelLi=_this.slider[sliderIndex].getElementsByTagName("li"),j=0;j<curWheelLi.length;j++)!function(j){curWheelLi[j].addEventListener("click",function(){_this.singleClick(this,j,sliderIndex)},!1)}(j)},checkDataType:function(){"object"==typeof this.wheelsData[0].data[0]&&(this.jsonType=!0)},checkCascade:function(){if(this.jsonType){for(var node=this.wheelsData[0].data,i=0;i<node.length;i++)if(this.keyMap.childs in node[i]&&0<node[i][this.keyMap.childs].length){this.cascade=!0,this.cascadeJsonData=this.wheelsData[0].data;break}}else this.cascade=!1},generateArrData:function(targetArr){for(var tempArr=[],keyMap_id=this.keyMap.id,keyMap_value=this.keyMap.value,i=0;i<targetArr.length;i++){var tempObj={};tempObj[keyMap_id]=targetArr[i][this.keyMap.id],tempObj[keyMap_value]=targetArr[i][this.keyMap.value],tempArr.push(tempObj)}return tempArr},initCascade:function(){this.displayJson.push(this.generateArrData(this.cascadeJsonData)),0<this.initPosition.length?(this.initDeepCount=0,this.initCheckArrDeep(this.cascadeJsonData[this.initPosition[0]])):this.checkArrDeep(this.cascadeJsonData[0]),this.reRenderWheels()},initCheckArrDeep:function(parent){var nextNode;parent&&this.keyMap.childs in parent&&0<parent[this.keyMap.childs].length&&(this.displayJson.push(this.generateArrData(parent[this.keyMap.childs])),this.initDeepCount++,(nextNode=parent[this.keyMap.childs][this.initPosition[this.initDeepCount]])?this.initCheckArrDeep(nextNode):this.checkArrDeep(parent[this.keyMap.childs][0]))},checkArrDeep:function(parent){parent&&this.keyMap.childs in parent&&0<parent[this.keyMap.childs].length&&(this.displayJson.push(this.generateArrData(parent[this.keyMap.childs])),this.checkArrDeep(parent[this.keyMap.childs][0]))},checkRange:function(index,posIndexArr){for(var resultNode,deleteNum=this.displayJson.length-1-index,i=0;i<deleteNum;i++)this.displayJson.pop();for(i=0;i<=index;i++)resultNode=0==i?this.cascadeJsonData[posIndexArr[0]]:resultNode[this.keyMap.childs][posIndexArr[i]];this.checkArrDeep(resultNode),this.reRenderWheels(),this.fixRowStyle(),this.setCurDistance(this.resetPostion(index,posIndexArr))},resetPostion:function(index,posIndexArr){var tempPosArr=posIndexArr;if(this.slider.length>posIndexArr.length)for(var tempCount=this.slider.length-posIndexArr.length,i=0;i<tempCount;i++)tempPosArr.push(0);else if(this.slider.length<posIndexArr.length){tempCount=posIndexArr.length-this.slider.length;for(i=0;i<tempCount;i++)tempPosArr.pop()}for(i=index+1;i<tempPosArr.length;i++)tempPosArr[i]=0;return tempPosArr},reRenderWheels:function(){var _this=this;if(_this.wheel.length>_this.displayJson.length)for(var count=_this.wheel.length-_this.displayJson.length,i=0;i<count;i++)_this.wheels.removeChild(_this.wheel[_this.wheel.length-1]);for(i=0;i<_this.displayJson.length;i++)!function(i){var tempHTML="";if(_this.wheel[i]){for(var j=0;j<_this.displayJson[i].length;j++)tempHTML+='<li data-id="'+_this.displayJson[i][j][_this.keyMap.id]+'">'+_this.displayJson[i][j][_this.keyMap.value]+"</li>";_this.slider[i].innerHTML=tempHTML}else{var tempWheel=document.createElement("div");tempWheel.className="wheel";for(tempHTML='<ul class="selectContainer">',j=0;j<_this.displayJson[i].length;j++)tempHTML+='<li data-id="'+_this.displayJson[i][j][_this.keyMap.id]+'">'+_this.displayJson[i][j][_this.keyMap.value]+"</li>";tempWheel.innerHTML=tempHTML+="</ul>",_this.addListenerWheel(tempWheel,i),_this.wheels.appendChild(tempWheel)}_this.addListenerLi(i)}(i)},updateWheels:function(data){if(this.cascade){if(this.cascadeJsonData=data,this.displayJson=[],this.initCascade(),this.initPosition.length<this.slider.length)for(var diff=this.slider.length-this.initPosition.length,i=0;i<diff;i++)this.initPosition.push(0);this.setCurDistance(this.initPosition),this.fixRowStyle()}},updateWheel:function(sliderIndex,data){var tempHTML="";if(this.cascade)return console.error("级联格式不支持updateWheel(),请使用updateWheels()更新整个数据源"),!1;if(this.jsonType){for(var j=0;j<data.length;j++)tempHTML+='<li data-id="'+data[j][this.keyMap.id]+'">'+data[j][this.keyMap.value]+"</li>";this.wheelsData[sliderIndex]={data:data}}else{for(j=0;j<data.length;j++)tempHTML+="<li>"+data[j]+"</li>";this.wheelsData[sliderIndex]=data}this.slider[sliderIndex].innerHTML=tempHTML,this.addListenerLi(sliderIndex)},fixRowStyle:function(){for(var width=(100/this.wheel.length).toFixed(2),i=0;i<this.wheel.length;i++)this.wheel[i].style.width=width+"%"},getIndex:function(distance){return Math.round((2*this.liHeight-distance)/this.liHeight)},getIndexArr:function(){for(var temp=[],i=0;i<this.curDistance.length;i++)temp.push(this.getIndex(this.curDistance[i]));return temp},getValue:function(){var temp=[],positionArr=this.getIndexArr();if(this.cascade)for(var i=0;i<this.wheel.length;i++)temp.push(this.displayJson[i][positionArr[i]]);else if(this.jsonType)for(i=0;i<this.curDistance.length;i++)temp.push(this.wheelsData[i].data[this.getIndex(this.curDistance[i])]);else for(i=0;i<this.curDistance.length;i++)temp.push(this.getInnerHtml(i));return temp},calcDistance:function(index){return 2*this.liHeight-index*this.liHeight},setCurDistance:function(indexArr){for(var temp=[],i=0;i<this.slider.length;i++)temp.push(this.calcDistance(indexArr[i])),this.movePosition(this.slider[i],temp[i]);this.curDistance=temp},fixPosition:function(distance){return-(this.getIndex(distance)-2)*this.liHeight},movePosition:function(theSlider,distance){theSlider.style.webkitTransform="translate3d(0,"+distance+"px, 0)",theSlider.style.transform="translate3d(0,"+distance+"px, 0)"},locatePostion:function(index,posIndex){this.curDistance[index]=this.calcDistance(posIndex),this.movePosition(this.slider[index],this.curDistance[index])},updateCurDistance:function(theSlider,index){this.curDistance[index]=parseInt(theSlider.style.transform.split(",")[1])},getDistance:function(theSlider){return parseInt(theSlider.style.transform.split(",")[1])},getInnerHtml:function(sliderIndex){var index=this.getIndex(this.curDistance[sliderIndex]);return this.slider[sliderIndex].getElementsByTagName("li")[index].innerHTML},touch:function(event,theSlider,index){var tempPosArr,_this=this;switch((event=event||window.event).type){case"touchstart":_this.startY=event.touches[0].clientY,_this.oldMoveY=_this.startY;break;case"touchend":_this.moveEndY=event.changedTouches[0].clientY,_this.offsetSum=_this.moveEndY-_this.startY,_this.updateCurDistance(theSlider,index),_this.curDistance[index]=_this.fixPosition(_this.curDistance[index]),_this.movePosition(theSlider,_this.curDistance[index]),_this.oversizeBorder=-(theSlider.getElementsByTagName("li").length-3)*_this.liHeight,_this.curDistance[index]+_this.offsetSum>2*_this.liHeight?(_this.curDistance[index]=2*_this.liHeight,setTimeout(function(){_this.movePosition(theSlider,_this.curDistance[index])},100)):_this.curDistance[index]+_this.offsetSum<_this.oversizeBorder&&(_this.curDistance[index]=_this.oversizeBorder,setTimeout(function(){_this.movePosition(theSlider,_this.curDistance[index])},100)),_this.transitionEnd(_this.getIndexArr(),_this.getValue()),_this.cascade&&((tempPosArr=_this.getIndexArr())[index]=_this.getIndex(_this.curDistance[index]),_this.checkRange(index,tempPosArr));break;case"touchmove":event.preventDefault(),_this.moveY=event.touches[0].clientY,_this.offset=_this.moveY-_this.oldMoveY,_this.updateCurDistance(theSlider,index),_this.curDistance[index]=_this.curDistance[index]+_this.offset,_this.movePosition(theSlider,_this.curDistance[index]),_this.oldMoveY=_this.moveY}},dragClick:function(event,theSlider,index){var tempPosArr,_this=this;switch((event=event||window.event).type){case"mousedown":_this.startY=event.clientY,_this.oldMoveY=_this.startY,_this.clickStatus=!0;break;case"mouseup":_this.moveEndY=event.clientY,_this.offsetSum=_this.moveEndY-_this.startY,_this.updateCurDistance(theSlider,index),_this.curDistance[index]=_this.fixPosition(_this.curDistance[index]),_this.movePosition(theSlider,_this.curDistance[index]),_this.oversizeBorder=-(theSlider.getElementsByTagName("li").length-3)*_this.liHeight,_this.curDistance[index]+_this.offsetSum>2*_this.liHeight?(_this.curDistance[index]=2*_this.liHeight,setTimeout(function(){_this.movePosition(theSlider,_this.curDistance[index])},100)):_this.curDistance[index]+_this.offsetSum<_this.oversizeBorder&&(_this.curDistance[index]=_this.oversizeBorder,setTimeout(function(){_this.movePosition(theSlider,_this.curDistance[index])},100)),_this.clickStatus=!1,_this.transitionEnd(_this.getIndexArr(),_this.getValue()),_this.cascade&&((tempPosArr=_this.getIndexArr())[index]=_this.getIndex(_this.curDistance[index]),_this.checkRange(index,tempPosArr));break;case"mousemove":event.preventDefault(),_this.clickStatus&&(_this.moveY=event.clientY,_this.offset=_this.moveY-_this.oldMoveY,_this.updateCurDistance(theSlider,index),_this.curDistance[index]=_this.curDistance[index]+_this.offset,_this.movePosition(theSlider,_this.curDistance[index]),_this.oldMoveY=_this.moveY)}},singleClick:function(theLi,index,sliderIndex){var tempPosArr;this.cascade?((tempPosArr=this.getIndexArr())[sliderIndex]=index,this.checkRange(sliderIndex,tempPosArr)):(this.curDistance[sliderIndex]=(2-index)*this.liHeight,this.movePosition(theLi.parentNode,this.curDistance[sliderIndex]))}},"object"==typeof exports?module.exports=MobileSelect:"function"==typeof define&&define.amd?define([],function(){return MobileSelect}):window.MobileSelect=MobileSelect}();